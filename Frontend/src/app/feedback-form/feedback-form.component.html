<div class="container">
  <h1 class="form-title">Feedback Form</h1>

  <form class="feedback-form" (ngSubmit)="saveFeedback(feedbackForm)" #feedbackForm="ngForm">

    <!-- Full Name -->
    <div class="form-group">
      <label>Full Name:</label>
      <input 
        type="text" 
        [(ngModel)]="feedback.fullName" 
        name="fullName" 
        #fullName="ngModel" 
        required 
        minlength="3"
      />
      <em *ngIf="fullName.errors?.['required'] && fullName.touched">
        Full name is required.
      </em>
      <em *ngIf="fullName.errors?.['minlength'] && fullName.touched">
        Full name must be at least 3 characters long.
      </em>
    </div>

    <!-- Email -->
    <div class="form-group">
      <label>Email:</label>
      <input 
        type="email" 
        [(ngModel)]="feedback.email" 
        name="email" 
        #email="ngModel" 
        required 
      />
      <em *ngIf="email.errors?.['required'] && email.touched">
        Email is required.
      </em>
      <em *ngIf="email.errors?.['email'] && email.touched">
        Must be a valid email.
      </em>
    </div>

    <!-- Phone Row -->
    <div class="form-group phone-row" ngModelGroup="phone">
      <div class="phone-input">
        <label>Phone Number:</label>
        <input 
          type="tel" 
          [(ngModel)]="feedback.phone.phoneNumber" 
          name="phoneNumber" 
          #phoneNumber="ngModel" 
          required 
          pattern="^[0-9\-\+\s]{7,15}$" 
        />
        <em *ngIf="phoneNumber.errors?.['required'] && phoneNumber.touched">
          Phone number is required.
        </em>
        <em *ngIf="phoneNumber.errors?.['pattern'] && phoneNumber.touched">
          Invalid phone format.
        </em>
      </div>

      <div class="phone-type">
        <label>Phone Type:</label>
        <select 
          [(ngModel)]="feedback.phone.phoneType" 
          name="phoneType" 
          #phoneType="ngModel" 
          required
        >
          <option *ngFor="let type of phoneTypes" [value]="type.value">
            {{ type.title }}
          </option>
        </select>
        <em *ngIf="phoneType.errors?.['required'] && phoneType.touched">
          Phone type is required.
        </em>
      </div>
    </div>

    <!-- Date of Visit -->
    <div class="form-group">
      <label>Date of Visit:</label>
      <input type="date" [(ngModel)]="feedback.dateOfVisit" name="dateOfVisit" />
    </div>

    <!-- Favorite Pizza -->
    <div class="form-group">
      <label>Favorite Pizza:</label>
      <select [(ngModel)]="feedback.favoritePizza" name="favoritePizza">
        @for(pizzaType of pizzaTypes; track pizzaType.value){
          <option [value]="pizzaType.value">{{pizzaType.title}}</option>
        }
      </select>
    </div>

    <!-- Rating -->
    <div class="form-group">
      <label>Rating (1â€“5):</label>
      <input 
        type="number" 
        [(ngModel)]="feedback.rating" 
        name="rating" 
        #rating="ngModel" 
        required 
        min="1" 
        max="5" 
      />
      <em *ngIf="rating.errors?.['required'] && rating.touched">
        Rating is required.
      </em>
      <em *ngIf="(rating.errors?.['min'] || rating.errors?.['max']) && rating.touched">
        Rating must be between 1 and 5.
      </em>
    </div>

    <!-- Service Satisfaction -->
    <div class="form-group range-group">
      <label>Service Satisfaction:</label>
      <div class="range-wrapper">
        <span>1</span>
        <input 
          type="range" 
          [(ngModel)]="feedback.serviceSatisfaction" 
          name="serviceSatisfaction" 
          min="1" 
          max="10" 
        />
        <span class="current-value">{{ feedback.serviceSatisfaction || 5 }}</span>
        <span>10</span>
      </div>
    </div>

    <!-- Would Recommend -->
    <div class="form-group checkbox-group">
      <label>
        <input 
          type="checkbox" 
          [(ngModel)]="feedback.wouldRecommend" 
          name="wouldRecommend" 
        />
        Would recommend to others
      </label>
    </div>

    <!-- Liked Toppings -->
    <div class="form-group">
      <label>Liked Toppings:</label>
      <input 
        type="text" 
        [(ngModel)]="feedback.likedToppings" 
        name="likedToppings" 
        placeholder="Comma separated e.g. Cheese, Olives" 
      />
    </div>

    <!-- Comments -->
    <div class="form-group">
      <label>Comments:</label>
      <textarea 
        [(ngModel)]="feedback.comments" 
        name="comments" 
        [restrictedWords]="['hate','hurt']" 
        #comments="ngModel"
      ></textarea>
      <em class="error-message" *ngIf="comments.errors?.['restrictedWords']">
        Restricted Words Found: {{ comments.errors?.['restrictedWords'] }}
      </em>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button 
        class="btn cancel" 
        type="button" 
        (click)="feedbackForm.reset()"
        [disabled]="feedbackForm.submitted"
      >
        Cancel
      </button>
      <button 
        class="btn save" 
        type="submit" 
        [disabled]="feedbackForm.invalid  || feedbackForm.submitted"
      >
        Save
      </button>
      <button class="btn saving" *ngIf="feedbackForm.submitted && feedbackForm.valid">
        Saving...
      </button>
    </div>

  </form>
</div>
